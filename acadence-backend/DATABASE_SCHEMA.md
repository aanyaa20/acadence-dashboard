# Database Schema Documentation for Gemini-Generated Courses

## Overview
This document describes the complete database schema designed to store courses generated by the Gemini AI. The schema is optimized for MongoDB and uses Mongoose ODM for data modeling.

## Collection Structure

The system uses **three main collections** that are related through ObjectId references:

```
┌─────────────┐
│   Course    │──┐
└─────────────┘  │
                 │  courseId
                 ├──────────> ┌─────────────┐
                 │            │   Lesson    │
                 │            └─────────────┘
                 │
                 │  courseId
                 └──────────> ┌─────────────┐
                              │    Quiz     │
                              └─────────────┘
```

---

## 1. Course Collection

### Schema Definition

```javascript
{
  _id: ObjectId,                    // Auto-generated by MongoDB
  userId: ObjectId,                 // Reference to User collection
  title: String,                    // Course title (required)
  topic: String,                    // Main subject/topic (required)
  description: String,              // Detailed course description
  difficulty: String,               // Enum: 'beginner', 'intermediate', 'advanced'
  estimatedDuration: String,        // Human-readable duration (e.g., '4 hours')
  learningObjectives: [String],     // Array of learning goals
  totalLessons: Number,             // Total number of lessons (default: 0)
  completedLessons: Number,         // User progress tracker (default: 0)
  createdAt: Date,                  // Auto-generated timestamp
  updatedAt: Date                   // Auto-updated timestamp
}
```

### Field Details

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `_id` | ObjectId | Auto | Auto-generated | Primary key |
| `userId` | ObjectId | Yes | - | References User who owns this course |
| `title` | String | Yes | - | Full course title (e.g., "Complete Python Programming") |
| `topic` | String | Yes | - | Main topic (e.g., "Python Programming") |
| `description` | String | No | - | Comprehensive course overview |
| `difficulty` | String | No | 'beginner' | Must be: 'beginner', 'intermediate', or 'advanced' |
| `estimatedDuration` | String | No | - | Duration estimate (e.g., "4 hours", "2 weeks") |
| `learningObjectives` | Array | No | [] | List of skills/knowledge to be gained |
| `totalLessons` | Number | No | 0 | Count of lessons in this course |
| `completedLessons` | Number | No | 0 | Progress: how many lessons user completed |
| `createdAt` | Date | Auto | Now | Course creation timestamp |
| `updatedAt` | Date | Auto | Now | Last modification timestamp |

### Example Document

```json
{
  "_id": "65abc123def456789",
  "userId": "65xyz789abc123456",
  "title": "Complete Python Programming for Beginners",
  "topic": "Python Programming",
  "description": "Learn Python from scratch with hands-on examples...",
  "difficulty": "beginner",
  "estimatedDuration": "6 hours",
  "learningObjectives": [
    "Understand Python syntax and data types",
    "Write functions and use built-in libraries",
    "Handle errors and exceptions",
    "Work with files and data structures"
  ],
  "totalLessons": 8,
  "completedLessons": 0,
  "createdAt": "2025-11-03T10:30:00.000Z",
  "updatedAt": "2025-11-03T10:30:00.000Z"
}
```

### Indexes (Recommended)

```javascript
// For efficient queries
db.courses.createIndex({ userId: 1 });
db.courses.createIndex({ topic: 1 });
db.courses.createIndex({ difficulty: 1 });
db.courses.createIndex({ createdAt: -1 });
```

---

## 2. Lesson Collection

### Schema Definition

```javascript
{
  _id: ObjectId,                    // Auto-generated by MongoDB
  courseId: ObjectId,               // Reference to Course collection
  title: String,                    // Lesson title (required)
  content: String,                  // Full lesson content (required, 300+ words)
  order: Number,                    // Sequential order (1, 2, 3...)
  duration: String,                 // Estimated time to complete
  points: Number,                   // Points awarded for completion (10-50)
  completed: Boolean,               // User completion status
  createdAt: Date,                  // Auto-generated timestamp
  updatedAt: Date                   // Auto-updated timestamp
}
```

### Field Details

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `_id` | ObjectId | Auto | Auto-generated | Primary key |
| `courseId` | ObjectId | Yes | - | References parent Course |
| `title` | String | Yes | - | Lesson title (e.g., "Variables and Data Types") |
| `content` | String | Yes | - | Detailed educational content (minimum 300 words) |
| `order` | Number | No | 1 | Sequential position in course (for sorting) |
| `duration` | String | No | - | Time estimate (e.g., "30 minutes", "1 hour") |
| `points` | Number | No | 10 | Reward points for completion (typically 10-50) |
| `completed` | Boolean | No | false | Whether user has completed this lesson |
| `createdAt` | Date | Auto | Now | Lesson creation timestamp |
| `updatedAt` | Date | Auto | Now | Last modification timestamp |

### Example Document

```json
{
  "_id": "65lesson123abc456",
  "courseId": "65abc123def456789",
  "title": "Introduction to Python Variables",
  "content": "In Python, variables are containers for storing data values...\n\n[Comprehensive content with examples, explanations, and exercises - minimum 300 words]",
  "order": 1,
  "duration": "45 minutes",
  "points": 20,
  "completed": false,
  "createdAt": "2025-11-03T10:30:05.000Z",
  "updatedAt": "2025-11-03T10:30:05.000Z"
}
```

### Content Structure Guidelines

The `content` field should include:
- **Introduction**: What will be covered
- **Core Concepts**: Detailed explanations
- **Examples**: Code snippets or practical demonstrations
- **Key Takeaways**: Summary of important points
- **Practice**: Exercises or questions for self-assessment

### Indexes (Recommended)

```javascript
db.lessons.createIndex({ courseId: 1, order: 1 });
db.lessons.createIndex({ courseId: 1, completed: 1 });
```

---

## 3. Quiz Collection

### Schema Definition

```javascript
{
  _id: ObjectId,                    // Auto-generated by MongoDB
  courseId: ObjectId,               // Reference to Course collection
  title: String,                    // Quiz title (required)
  description: String,              // Quiz description/instructions
  questions: [{                     // Array of question objects
    ques: String,                   // Question text (required)
    answer: String                  // Correct answer with explanation (required)
  }],
  score: Number,                    // Total points for quiz (50-100)
  createdAt: Date,                  // Auto-generated timestamp
  updatedAt: Date                   // Auto-updated timestamp
}
```

### Field Details

| Field | Type | Required | Default | Description |
|-------|------|----------|---------|-------------|
| `_id` | ObjectId | Auto | Auto-generated | Primary key |
| `courseId` | ObjectId | Yes | - | References parent Course |
| `title` | String | Yes | - | Quiz title (e.g., "Python Fundamentals Quiz") |
| `description` | String | No | - | Instructions or overview |
| `questions` | Array | Yes | - | Array of question-answer pairs |
| `questions[].ques` | String | Yes | - | The question text |
| `questions[].answer` | String | Yes | - | Correct answer with brief explanation |
| `score` | Number | Yes | - | Total points available (typically 50-100) |
| `createdAt` | Date | Auto | Now | Quiz creation timestamp |
| `updatedAt` | Date | Auto | Now | Last modification timestamp |

### Example Document

```json
{
  "_id": "65quiz789xyz123",
  "courseId": "65abc123def456789",
  "title": "Python Fundamentals Assessment",
  "description": "Test your understanding of Python basics with these 5 questions.",
  "questions": [
    {
      "ques": "What is a variable in Python?",
      "answer": "A variable is a named container that stores data values. In Python, you don't need to declare variable types explicitly."
    },
    {
      "ques": "Which of the following is a mutable data type in Python?",
      "answer": "List is a mutable data type. Lists can be modified after creation, unlike tuples which are immutable."
    },
    {
      "ques": "What does the len() function do?",
      "answer": "The len() function returns the number of items in an object, such as the number of characters in a string or elements in a list."
    },
    {
      "ques": "How do you start a single-line comment in Python?",
      "answer": "Use the # symbol to start a single-line comment. Everything after # on that line is ignored by the Python interpreter."
    },
    {
      "ques": "What is the output of print(type(5.5))?",
      "answer": "<class 'float'> - The type() function returns the data type of a value, and 5.5 is a floating-point number."
    }
  ],
  "score": 100,
  "createdAt": "2025-11-03T10:30:10.000Z",
  "updatedAt": "2025-11-03T10:30:10.000Z"
}
```

### Question Format Guidelines

Each question should:
- Be clear and unambiguous
- Test understanding of course material
- Include the correct answer
- Provide a brief explanation with the answer

### Indexes (Recommended)

```javascript
db.quizzes.createIndex({ courseId: 1 });
```

---

## Relationships

### One-to-Many: Course → Lessons
- One course can have multiple lessons
- Each lesson belongs to exactly one course
- Link: `Lesson.courseId` → `Course._id`

### One-to-One: Course → Quiz
- One course has one comprehensive quiz
- Quiz covers all course material
- Link: `Quiz.courseId` → `Course._id`

---

## Gemini Output Format

When Gemini generates a course, it returns this JSON structure:

```json
{
  "course": {
    "title": "string",
    "topic": "string",
    "description": "string",
    "difficulty": "string",
    "estimatedDuration": "string",
    "learningObjectives": ["string"]
  },
  "lessons": [
    {
      "title": "string",
      "content": "string (300+ words)",
      "order": number,
      "points": number,
      "duration": "string"
    }
  ],
  "quiz": {
    "title": "string",
    "description": "string",
    "questions": [
      {
        "ques": "string",
        "answer": "string"
      }
    ],
    "score": number
  }
}
```

This maps directly to the database schemas, ensuring seamless data storage.

---

## Validation Rules

### Course
- ✅ `title`: Non-empty string, trimmed
- ✅ `topic`: Non-empty string, trimmed
- ✅ `difficulty`: Must be 'beginner', 'intermediate', or 'advanced'
- ✅ `totalLessons`: Non-negative number
- ✅ `completedLessons`: Non-negative, ≤ totalLessons

### Lesson
- ✅ `title`: Non-empty string, trimmed
- ✅ `content`: Non-empty string (minimum 300 words recommended)
- ✅ `order`: Positive number
- ✅ `points`: Positive number (10-50 recommended)

### Quiz
- ✅ `title`: Non-empty string, trimmed
- ✅ `questions`: Array with at least 1 question (5 recommended)
- ✅ `questions[].ques`: Non-empty string
- ✅ `questions[].answer`: Non-empty string
- ✅ `score`: Positive number (50-100 recommended)

---

## Query Examples

### Get all courses for a user
```javascript
db.courses.find({ userId: ObjectId("user_id") })
  .sort({ createdAt: -1 });
```

### Get all lessons for a course (ordered)
```javascript
db.lessons.find({ courseId: ObjectId("course_id") })
  .sort({ order: 1 });
```

### Get quiz for a course
```javascript
db.quizzes.findOne({ courseId: ObjectId("course_id") });
```

### Get course with all related data
```javascript
// Using Mongoose populate
const course = await Course.findById(courseId);
const lessons = await Lesson.find({ courseId }).sort({ order: 1 });
const quiz = await Quiz.findOne({ courseId });
```

---

## Migration Notes

If you have existing courses, you may need to migrate:

```javascript
// Add new fields to existing courses
db.courses.updateMany(
  { difficulty: { $exists: false } },
  { 
    $set: { 
      difficulty: 'beginner',
      estimatedDuration: '',
      learningObjectives: []
    }
  }
);

// Add order to existing lessons
db.lessons.find({ order: { $exists: false } }).forEach((lesson, index) => {
  db.lessons.updateOne(
    { _id: lesson._id },
    { $set: { order: index + 1, duration: '' } }
  );
});
```

---

## Performance Optimization

### Indexing Strategy
1. **User-based queries**: Index on `userId` in courses
2. **Course-based queries**: Index on `courseId` in lessons and quizzes
3. **Sorting**: Index on `createdAt` for recent courses, `order` for lessons

### Aggregation Pipeline Example
```javascript
// Get course statistics
db.courses.aggregate([
  { $match: { userId: ObjectId("user_id") } },
  { $lookup: {
      from: "lessons",
      localField: "_id",
      foreignField: "courseId",
      as: "lessons"
  }},
  { $addFields: {
      lessonCount: { $size: "$lessons" },
      completionRate: {
        $multiply: [
          { $divide: ["$completedLessons", "$totalLessons"] },
          100
        ]
      }
  }}
]);
```

---

**Document Version**: 1.0.0  
**Last Updated**: November 3, 2025  
**Status**: Production Ready ✅
